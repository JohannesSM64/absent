#!/bin/bash
# Tool for Arch Linux to search a tree of PKGBUILDs and build packages.
# 2010-2014, Johannes Lang√∏y. Public domain.

searchdirs=("/var/abs/core" "/var/abs/extra" "/var/abs/community")
builddir="/tmp/absent-$USER"
mkdir -p "$builddir"

case "$1" in
    -S)
        for dir in "${searchdirs[@]}"; do
            if [[ -d "$dir/$2/" && -f "$dir/$2/PKGBUILD" ]]; then
                match="$dir/$2/"
                break 2
            fi
        done
        if [[ -z "$match" ]]; then
            echo "No match found."
            exit 1
        fi
        cp -r "$match" "$builddir"
        cd "$builddir/$(basename $match)"
        makepkg -fsci
esac
